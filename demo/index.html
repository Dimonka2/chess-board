<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Widget Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 40px;
        }
        
        .demo-section {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 32px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .demo-section h2 {
            margin-top: 0;
            color: #555;
            border-bottom: 2px solid #eee;
            padding-bottom: 8px;
        }
        
        .puzzle-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        
        .puzzle-info {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 16px;
            border-left: 4px solid #3291ff;
        }
        
        .puzzle-info h3 {
            margin: 0 0 8px 0;
            color: #333;
        }
        
        .puzzle-info p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
        
        pre {
            background: #f4f4f4;
            padding: 16px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 16px 0;
        }
        
        code {
            background: #f4f4f4;
            padding: 2px 4px;
            border-radius: 2px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }
        
        @media (max-width: 768px) {
            .puzzle-container {
                flex-direction: column;
                align-items: center;
            }
        }
        
        /* ELO Selector Styles */
        .elo-selector {
            display: flex;
            gap: 6px;
            margin: 16px 0;
            justify-content: center;
            flex-wrap: wrap;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .elo-btn {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #dee2e6;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
            min-width: 70px;
        }
        
        .elo-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }
        
        .elo-btn.active {
            background: #3291ff;
            color: white;
            border-color: #3291ff;
        }
        
        .elo-group {
            display: none;
            width: 100%;
        }
        
        .elo-group.active {
            display: block;
        }
        
        .puzzle-item {
            text-align: center;
            margin: 20px 0;
        }
        
        .puzzle-item h4 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 18px;
        }
        
        .puzzle-item p {
            margin: 0 0 16px 0;
            color: #666;
            font-style: italic;
        }

        .header-links {
            text-align: center;
            margin: -20px 0 40px 0;
        }

        .header-links a {
            color: #3291ff;
            text-decoration: none;
            font-size: 16px;
            margin: 0 16px;
            font-weight: 500;
        }

        .header-links a:hover {
            text-decoration: underline;
        }

        /* Event console styles for state management demo */
        .event-console {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 16px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 16px;
        }

        .event-console .event-line {
            margin: 4px 0;
            padding: 2px 0;
            border-bottom: 1px solid #333;
        }

        .event-console .event-name {
            color: #4ec9b0;
            font-weight: bold;
        }

        .event-console .event-data {
            color: #ce9178;
        }

        .event-console .timestamp {
            color: #6a9955;
            font-size: 10px;
        }

        .state-display {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 14px;
            margin: 8px 0;
        }

        .state-not_started {
            background: #e3f2fd;
            color: #1565c0;
        }

        .state-in_progress {
            background: #fff3e0;
            color: #e65100;
        }

        .state-wrong_move {
            background: #ffebee;
            color: #c62828;
        }

        .state-solved {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
            margin-top: 20px;
        }

        .feature-box {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
        }

        .feature-box h3 {
            margin-top: 0;
            color: #495057;
        }

        .clear-console-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 8px;
        }

        .clear-console-btn:hover {
            background: #5a6268;
        }
    </style>

    <!-- Production CSS - comment out for local Vite development -->
    <link rel="stylesheet" href="chess-widget.min.css">
</head>
<body>
    <h1>Chess Widget Demo</h1>
    <div class="header-links">
        <a href="https://github.com/Dimonka2/chess-board" target="_blank">üì¶ GitHub Repository</a>
        <a href="https://github.com/Dimonka2/chess-board#readme" target="_blank">üìñ Documentation</a>
    </div>

    <div class="demo-section">
        <h2>Tactical Puzzles by ELO Rating</h2>
        <div class="puzzle-info">
            <h3>Choose Difficulty Level</h3>
            <p>Select your skill level to see appropriate puzzles. Try to solve each puzzle by finding the best move!</p>
            <div class="elo-selector">
                <button class="elo-btn active" data-elo="600">ELO 600</button>
                <button class="elo-btn" data-elo="800">ELO 800</button>
                <button class="elo-btn" data-elo="1000">ELO 1000</button>
                <button class="elo-btn" data-elo="1200">ELO 1200</button>
                <button class="elo-btn" data-elo="1400">ELO 1400</button>
                <button class="elo-btn" data-elo="1600">ELO 1600</button>
                <button class="elo-btn" data-elo="1800">ELO 1800</button>
                <button class="elo-btn" data-elo="2000">ELO 2000</button>
                <button class="elo-btn" data-elo="2200">ELO 2200</button>
                <button class="elo-btn" data-elo="2400">ELO 2400</button>
            </div>
        </div>
        <div class="puzzle-container" id="elo-puzzles">
            <!-- ELO 600 Puzzles -->
            <div class="elo-group active" data-elo="600">
                <div class="puzzle-item">
                    <h4>Back-Rank Mate</h4>
                    <p>Lichess #jbwGi - Back-rank mate: Black plays Rb1, White must defend with Re1</p>
                    <div class="chess-puzzle"
                         data-fen="1r6/2p2pkp/2npb1p1/4p3/4P3/RBPP1N2/5PPP/6K1 w - - 1 24"
                         data-premove-enabled="true"
                         data-solution="b3e6,b8b1,f3e1,b1e1"
                         data-width="400"
                         data-orientation="black">
                    </div>
                </div>
            </div>
            
            <!-- ELO 800 Puzzles -->
            <div class="elo-group" data-elo="800">
                <div class="puzzle-item">
                    <h4>Endgame Mate in 2</h4>
                    <p>Lichess #RLHH3 - White plays Ra7, black must respond Rd1+, then Kc2 and Ne3#</p>
                    <div class="chess-puzzle"
                         data-fen="8/1R4p1/4p1kp/3rBn2/p4P2/2P5/PP5P/1K6 w - - 1 35"
                         data-premove-enabled="true"
                         data-solution="b7a7,d5d1,b1c2,f5e3"
                         data-width="400"
                         data-orientation="black">
                    </div>
                </div>
            </div>
            
            <!-- ELO 1000 Puzzles -->
            <div class="elo-group" data-elo="1000">
                <div class="puzzle-item">
                    <h4>Mate in 2</h4>
                    <p>Lichess #diRlH - Black plays Kf8, White responds Ba3 to control c5</p>
                    <div class="chess-puzzle"
                         data-fen="rnb1k2r/ppp2Ppp/8/8/2B5/2P5/P1K3PP/R1B3Nn b kq - 0 11"
                         data-premove-enabled="true"
                         data-solution="e8f8,c1a3,c7c5,a3c5"
                         data-width="400"
                         data-orientation="white">
                    </div>
                </div>
            </div>
            
            <!-- ELO 1200 Puzzles -->
            <div class="elo-group" data-elo="1200">
                <div class="puzzle-item">
                    <h4>Rook Endgame Mate</h4>
                    <p>Lichess #oqrBK - Black plays Kg5, White responds Rg4+ then Rh1#</p>
                    <div class="chess-puzzle"
                         data-fen="5r2/6p1/1p1p1r2/pPp1p3/P1PpPk1R/3P1P2/4K1P1/6R1 b - - 0 40"
                         data-premove-enabled="true"
                         data-solution="f4g5,h4g4,g5h6,g1h1"
                         data-width="400"
                         data-orientation="white">
                    </div>
                </div>
            </div>
            
            <!-- ELO 1400 Puzzles -->
            <div class="elo-group" data-elo="1400">
                <div class="puzzle-item">
                    <h4>Hook Mate</h4>
                    <p>Lichess #BveME - White plays Rc5, Black responds Rd1+, then Kf2 and Rf1#</p>
                    <div class="chess-puzzle"
                         data-fen="3r1k2/1R6/p7/2b1R3/5p2/4n3/PPP1N1PP/4K3 w - - 1 31"
                         data-premove-enabled="true"
                         data-solution="e5c5,d8d1,e1f2,d1f1"
                         data-width="400"
                         data-orientation="black">
                    </div>
                </div>
            </div>
            
            <!-- ELO 1600 Puzzles -->
            <div class="elo-group" data-elo="1600">
                <div class="puzzle-item">
                    <h4>Fork Endgame</h4>
                    <p>Lichess #sYcXL - White plays Rxf2, Black responds Qxf2+, then Kh2 and Qg2#</p>
                    <div class="chess-puzzle"
                         data-fen="6k1/p2Q3p/8/3p2p1/8/1P2q2P/P1r2rP1/4RRK1 w - - 0 34"
                         data-premove-enabled="true"
                         data-solution="f1f2,e3f2,g1h2,f2g2"
                         data-width="400"
                         data-orientation="black">
                    </div>
                </div>
            </div>
            
            <!-- ELO 1800 Puzzles -->
            <div class="elo-group" data-elo="1800">
                <div class="puzzle-item">
                    <h4>Mate in 2 Middlegame</h4>
                    <p>Lichess #qGdZQ - White plays Kf4, Black responds Qh2+, then g3 and Qxg3#</p>
                    <div class="chess-puzzle"
                         data-fen="2R5/p4p2/1p4k1/5nB1/4Q3/1P3PKP/4R1P1/3r3q w - - 3 42"
                         data-premove-enabled="true"
                         data-solution="g3f4,h1h2,g2g3,h2g3"
                         data-width="400"
                         data-orientation="black">
                    </div>
                </div>
            </div>
            
            <!-- ELO 2000 Puzzles -->
            <div class="elo-group" data-elo="2000">
                <div class="puzzle-item">
                    <h4>Master Endgame</h4>
                    <p>Lichess #nR6zG - Master vs Master: White plays Ke1, Black responds Qe3+, then Kd1 and Bb3#</p>
                    <div class="chess-puzzle"
                         data-fen="R7/5p1k/2p1b1p1/2P4p/1P5P/5qP1/8/Q4K2 w - - 0 55"
                         data-premove-enabled="true"
                         data-solution="f1e1,f3e3,e1d1,e6b3"
                         data-width="400"
                         data-orientation="black">
                    </div>
                </div>
            </div>
            
            <!-- ELO 2200 Puzzles -->
            <div class="elo-group" data-elo="2200">
                <div class="puzzle-item">
                    <h4>Kingside Attack Mate in 3</h4>
                    <p>Lichess #U5No7 - Attraction pattern: Black plays ...Rxf4, White Qxh8+, then Kf7, g6+, Kg6, and Qh5#</p>
                    <div class="chess-puzzle"
                         data-fen="rnbq1rk1/pp1nb1p1/4p3/3pP1PQ/3p1P2/2P5/PP1N2P1/R1B1K2R b KQ - 2 13"
                         data-premove-enabled="true"
                         data-solution="f8f4,h5h8,g8f7,g5g6,f7g6,h8h5"
                         data-width="400"
                         data-orientation="white">
                    </div>
                </div>
            </div>
            
            <!-- ELO 2400 Puzzles -->
            <div class="elo-group" data-elo="2400">
                <div class="puzzle-item">
                    <h4>Complex Endgame Mate in 3</h4>
                    <p>Lichess #rfaGy - White plays Bb4, Black responds Rxf2+, then Kg1, Rg2+, Kf1, and Rxf2#</p>
                    <div class="chess-puzzle"
                         data-fen="6rk/1R6/2RB3p/8/1p2p3/1P1n3P/r5P1/5K2 w - - 6 45"
                         data-premove-enabled="true"
                         data-solution="d6b4,a2f2,f1g1,f2g2,g1f1,g2f2"
                         data-width="400"
                         data-orientation="black">
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="demo-section">
        <h2>Back-Rank Mate</h2>
        <div class="puzzle-info">
            <h3>Checkmate in 1</h3>
            <p>White to move and deliver checkmate. The black king is trapped by its own pawns on the back rank. Solution: Re8#</p>
        </div>
        <div class="puzzle-container">
            <div class="chess-puzzle" 
                 data-fen="rnb3kr/p4ppp/8/8/8/8/5PPP/4R1K1 w - - 0 1"
                         data-solution="e1e8"
                 data-width="400">
            </div>
        </div>
    </div>

    <div class="demo-section">
        <h2>Fork Tactic</h2>
        <div class="puzzle-info">
            <h3>Knight Fork</h3>
            <p>Lichess #NOb2c (ELO 900) - Black plays ...Qxd4, White responds Ne6, then Kf6, and Nxd4</p>
        </div>
        <div class="puzzle-container">
            <div class="chess-puzzle"
                 data-fen="2r5/1bN3k1/p5p1/1p1p3p/1P1P4/P3q1P1/2Q4P/2R2K2 b - - 1 34"
                 data-premove-enabled="true"
                 data-solution="e3d4,c7e6,g7f6,e6d4"
                 data-width="400"
                 data-orientation="white">
            </div>
        </div>
    </div>

    <div class="demo-section">
        <h2>Pin Tactic</h2>
        <div class="puzzle-info">
            <h3>Pin Leading to Mate</h3>
            <p>Lichess #sTLMK (ELO 1260 Master Game) - Black plays ...Qxf6, White Re8+, then Kg7, and Nh5#</p>
        </div>
        <div class="puzzle-container">
            <div class="chess-puzzle"
                 data-fen="6k1/1p3p1p/p2r2p1/3pqbQ1/5N2/2P1R2P/PP3PP1/6K1 b - - 3 30"
                 data-premove-enabled="true"
                 data-solution="e5f6,e3e8,g8g7,f4h5"
                 data-width="400"
                 data-orientation="white">
            </div>
        </div>
    </div>

    <div class="demo-section">
        <h2>Discovered Attack</h2>
        <div class="puzzle-info">
            <h3>Discovered Attack Wins Material</h3>
            <p>Lichess #fOtTP (ELO 1050 Master Game) - White plays Nd4, Black responds ...Bxa2, then Nxa2, and ...Qxd6</p>
        </div>
        <div class="puzzle-container">
            <div class="chess-puzzle"
                 data-fen="rn3rk1/5pbp/2pQbqp1/1p6/p3P3/P1N2P2/1PP1N1PP/1K1R1B1R w - - 0 14"
                 data-premove-enabled="true"
                 data-solution="e2d4,e6a2,c3a2,f6d6"
                 data-width="400"
                 data-orientation="black">
            </div>
        </div>
    </div>
    
    <div class="demo-section">
        <h2>Auto-Flip Board (Black to Move)</h2>
        <div class="puzzle-info">
            <h3>Board Flips with Turn</h3>
            <p>This board automatically rotates when it's black's turn. Try making moves to see the flip!</p>
        </div>
        <div class="puzzle-container">
            <div class="chess-puzzle" 
                 data-fen="rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq e3 0 1"
                 data-auto-flip="true"
                 data-width="400">
            </div>
        </div>
    </div>

    <div class="demo-section">
        <h2>Free Play Mode</h2>
        <div class="puzzle-info">
            <h3>Standard Starting Position</h3>
            <p>No solution defined - free play mode. Make any legal moves you want!</p>
        </div>
        <div class="puzzle-container">
            <div class="chess-puzzle" 
                 data-fen="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"
                 data-width="400">
            </div>
        </div>
    </div>
    
    <div class="demo-section">
        <h2>Different Board Sizes</h2>
        <div class="puzzle-container">
            <div class="chess-puzzle" 
                 data-fen="r1bqkbnr/pppp1ppp/2n5/4p3/4P3/5N2/PPPP1PPP/RNBQKB1R w KQkq - 2 3"
                 data-width="300">
            </div>
            <div class="chess-puzzle" 
                 data-fen="r1bqkbnr/pppp1ppp/2n5/4p3/4P3/5N2/PPPP1PPP/RNBQKB1R w KQkq - 2 3"
                 data-width="500">
            </div>
        </div>
    </div>

    <div class="demo-section">
        <h2>üÜï Alternative Solutions (Phase 1 Feature!)</h2>
        <div class="puzzle-info">
            <h3>Multiple Paths to Victory</h3>
            <p>This puzzle accepts multiple correct solutions! After Re1, both Qh5 and Qf3 lead to checkmate.</p>
        </div>
        <div class="puzzle-container">
            <div class="chess-puzzle"
                 data-fen="r1bqkb1r/pppp1ppp/2n2n2/4p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 0 1"
                 data-solution="f1e1,e5e4,d1h5|f1e1,e5e4,d1f3"
                 data-width="400">
            </div>
        </div>
        <pre><code>&lt;div class="chess-puzzle"
     data-solution="f1e1,e5e4,d1h5|f1e1,e5e4,d1f3"&gt;
&lt;!-- Use pipe | to separate alternative solutions --&gt;
&lt;/div&gt;</code></pre>
    </div>

    <div class="demo-section">
        <h2>üÜï Stockfish Counter-Move with Arrows (Phase 3 Feature!)</h2>
        <div class="puzzle-info">
            <h3>AI-Powered Feedback with Visual Arrows</h3>
            <p>When you make a wrong move, Stockfish shows you why it's wrong by playing its best counter-move with a red arrow! Try making a wrong move to see it in action.</p>
        </div>
        <div class="puzzle-container">
            <div class="chess-puzzle"
                 data-fen="r1bqkb1r/pppp1ppp/2n2n2/4p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 0 1"
                 data-solution="d1e2,f6e4,e2e4"
                 data-stockfish-enabled="true"
                 data-stockfish-depth="10"
                 data-stockfish-show-arrow="true"
                 data-width="400">
            </div>
        </div>
        <pre><code>&lt;div class="chess-puzzle"
     data-stockfish-enabled="true"
     data-stockfish-depth="10"
     data-stockfish-show-arrow="true"&gt;
&lt;!-- Stockfish will show counter-moves with red arrows --&gt;
&lt;/div&gt;</code></pre>
    </div>

    <div class="demo-section">
        <h2>üÜï Internationalization (Phase 1 Feature!)</h2>
        <div class="puzzle-info">
            <h3>Multi-Language Support</h3>
            <p>Widgets now support multiple languages! Try these puzzles in English and German.</p>
        </div>
        <div class="puzzle-container">
            <div style="text-align: center; margin: 20px;">
                <h4>English (default)</h4>
                <div class="chess-puzzle"
                     data-fen="rnb3kr/p4ppp/8/8/8/8/5PPP/4R1K1 w - - 0 1"
                     data-solution="e1e8"
                     data-lang="en"
                     data-width="350">
                </div>
            </div>
            <div style="text-align: center; margin: 20px;">
                <h4>Deutsch (German)</h4>
                <div class="chess-puzzle"
                     data-fen="rnb3kr/p4ppp/8/8/8/8/5PPP/4R1K1 w - - 0 1"
                     data-solution="e1e8"
                     data-lang="de"
                     data-width="350">
                </div>
            </div>
        </div>
        <pre><code>&lt;div class="chess-puzzle"
     data-lang="de"&gt; &lt;!-- German language --&gt;
&lt;/div&gt;</code></pre>
    </div>

    <!-- Phase 5 Features Demo -->
    <div class="demo-section">
        <h2>üéØ Phase 5: State Management & Wrong Move Retention</h2>
        <div class="puzzle-info">
            <h3>New Features Overview</h3>
            <p>The widget now includes external state management with event tracking and optional wrong move retention for deeper analysis!</p>
        </div>

        <div class="feature-grid">
            <!-- State Management Demo -->
            <div class="feature-box">
                <h3>üìä State Management & Event Tracking</h3>
                <p>Watch real-time events as you solve this puzzle. The console below shows all state changes and move attempts.</p>
                <p style="font-size: 12px; color: #666;">Lichess Puzzle #1400 ELO - Mate in 2, Middlegame Fork</p>
                <div class="chess-puzzle" id="state-demo-puzzle"
                     data-fen="2r2r2/kp3qp1/p3n2p/Q1pN4/4P3/B7/P4RPP/1R5K b - - 0 28"
                     data-premove-enabled="true"
                     data-solution="f7f2,a5b6,a7b8,b6b7"
                     data-width="350"
                     data-orientation="white"
                     data-expose-state-events="true"
                     data-stockfish-enabled="true">
                </div>
                <div style="margin-top: 12px;">
                    <strong>Current State:</strong> <span id="current-state" class="state-display state-not_started">not_started</span>
                </div>
                <div class="event-console" id="event-console">
                    <div style="color: #6a9955;">// Events will appear here...</div>
                </div>
                <button class="clear-console-btn" onclick="clearConsole()">Clear Console</button>
            </div>

            <!-- Wrong Move Retention Demo -->
            <div class="feature-box">
                <h3>‚è∏Ô∏è Wrong Move Retention</h3>
                <p>Try making a wrong move! The position will be retained with a question mark indicator. Use the "Undo Wrong Move" button to continue.</p>
                <p style="font-size: 12px; color: #666;">Lichess Puzzle #1400 ELO - Mate in 2, Middlegame Fork</p>
                <div class="chess-puzzle" id="retention-demo-puzzle"
                     data-fen="2r2r2/kp3qp1/p3n2p/Q1pN4/4P3/B7/P4RPP/1R5K b - - 0 28"
                     data-premove-enabled="true"
                     data-solution="f7f2,a5b6,a7b8,b6b7"
                     data-width="350"
                     data-orientation="white"
                     data-retain-wrong-moves="true"
                     data-stockfish-enabled="true"
                     data-stockfish-show-arrow="true">
                </div>
                <div style="margin-top: 12px; padding: 12px; background: #fff3cd; border-radius: 4px; border-left: 4px solid #ffc107;">
                    <strong>üí° Tip:</strong> Notice the yellow arrow (your move) and red arrow (Stockfish counter-move) when you make a mistake!
                </div>
            </div>
        </div>

        <!-- API Usage Example -->
        <div style="margin-top: 24px; padding: 16px; background: #f8f9fa; border-radius: 4px;">
            <h3>üíª API Usage Example</h3>
            <p>Here's how to subscribe to events programmatically:</p>
            <pre><code>// Get the widget state instance
const puzzle = document.getElementById('my-puzzle').widgetState;

// Subscribe to all state changes
puzzle.on('stateChange', ({ previous, current, metadata }) => {
  console.log(`State changed: ${previous} ‚Üí ${current}`);
});

// Subscribe to specific events
puzzle.on('wrongMove', ({ move }) => {
  console.warn(`Wrong move: ${move}`);
});

puzzle.on('puzzleSolved', () => {
  console.log('Congratulations! üéâ');
});

// Get current state
const currentState = puzzle.getState(); // 'not_started' | 'in_progress' | 'wrong_move' | 'solved'

// Get state history
const history = puzzle.getStateHistory();
</code></pre>
        </div>
    </div>

    <div class="demo-section">
        <h2>How to Use</h2>
        <p>To add a chess widget to your website, simply include the CSS and JavaScript files, then add a div with the appropriate data attributes:</p>
        
        <pre><code>&lt;!-- Include the widget files --&gt;
&lt;link rel="stylesheet" href="chess-widget.min.css"&gt;
&lt;script src="chess-widget.min.js"&gt;&lt;/script&gt;

&lt;!-- Create a puzzle --&gt;
&lt;div class="chess-puzzle" 
     data-fen="r1bqkbnr/pppp1ppp/2n5/4p3/4P3/5N2/PPPP1PPP/RNBQKB1R w KQkq - 2 3"
     data-solution="d2d4,e5d4,c2c3"
     data-width="400"&gt;
&lt;/div&gt;</code></pre>
        
        <h3>Data Attributes</h3>
        <ul>
            <li><strong>Core Attributes:</strong></li>
            <li><code>data-fen</code>: The chess position in FEN notation (required)</li>
            <li><code>data-solution</code>: Solution moves - comma-separated, use "|" for alternative paths (optional, enables puzzle mode)</li>
            <li><code>data-lang</code>: Language code - "en" (English, default) or "de" (German) (optional)</li>
            <li><code>data-width</code>: Board width in pixels (optional, default: 400)</li>
            <li><code>data-auto-flip</code>: Auto-rotate board for black's turn (optional, set to "true" to enable)</li>
            <li><code>data-orientation</code>: Fixed orientation - "white" or "black" (optional, overrides auto-flip)</li>
            <li><code>data-premove-enabled</code>: Play first solution move automatically (optional, for Lichess imports)</li>
            <li><strong>Stockfish Features:</strong></li>
            <li><code>data-stockfish-enabled</code>: Enable Stockfish counter-move feedback (optional, set to "true")</li>
            <li><code>data-stockfish-depth</code>: Stockfish analysis depth 1-20 (optional, default: 12)</li>
            <li><code>data-stockfish-timeout</code>: Max API wait time in ms (optional, default: 2000)</li>
            <li><code>data-stockfish-cache-enabled</code>: Enable localStorage caching (optional, default: true)</li>
            <li><code>data-stockfish-show-arrow</code>: Show red arrow for counter-move (optional, default: true)</li>
            <li><strong>Phase 5 Features (State Management & Wrong Move Retention):</strong></li>
            <li><code>data-expose-state-events</code>: Enable external state tracking and events (optional, default: true)</li>
            <li><code>data-retain-wrong-moves</code>: Keep wrong moves visible until manual undo (optional, default: false)</li>
        </ul>
        
        <p>The widget is completely standalone with all dependencies (chessground and chess.js) bundled - no CDN calls required!</p>
    </div>
    
    <!-- Production JS - comment out for local Vite development -->
    <script src="chess-widget.min.js"></script>

    <!-- Development JS - uncomment for local Vite development -->
    <!-- <script type="module" src="./main.js"></script> -->

    <script>
        // Clear event console
        function clearConsole() {
            const console = document.getElementById('event-console');
            console.innerHTML = '<div style="color: #6a9955;">// Events will appear here...</div>';
        }

        // State management demo setup
        function setupStateDemo() {
            const puzzleElement = document.getElementById('state-demo-puzzle');
            const stateDisplay = document.getElementById('current-state');
            const eventConsole = document.getElementById('event-console');

            if (!puzzleElement || !puzzleElement.widgetState) {
                console.warn('State demo puzzle not initialized yet');
                return;
            }

            const puzzleState = puzzleElement.widgetState;

            // Function to log events to the console
            function logEvent(eventName, data) {
                const timestamp = new Date().toLocaleTimeString();
                const eventLine = document.createElement('div');
                eventLine.className = 'event-line';

                const dataStr = JSON.stringify(data, null, 2);
                eventLine.innerHTML = `
                    <span class="timestamp">[${timestamp}]</span>
                    <span class="event-name">${eventName}</span>
                    <span class="event-data">${dataStr}</span>
                `;

                // Remove placeholder if exists
                if (eventConsole.firstChild && eventConsole.firstChild.textContent.includes('Events will appear here')) {
                    eventConsole.innerHTML = '';
                }

                eventConsole.appendChild(eventLine);
                eventConsole.scrollTop = eventConsole.scrollHeight;
            }

            // Update state display
            function updateStateDisplay(state) {
                stateDisplay.textContent = state;
                stateDisplay.className = 'state-display state-' + state;
            }

            // Subscribe to all events
            puzzleState.on('stateChange', (data) => {
                logEvent('stateChange', data);
                updateStateDisplay(data.current);
            });

            puzzleState.on('moveAttempted', (data) => {
                logEvent('moveAttempted', data);
            });

            puzzleState.on('correctMove', (data) => {
                logEvent('correctMove', data);
            });

            puzzleState.on('wrongMove', (data) => {
                logEvent('wrongMove', data);
            });

            puzzleState.on('puzzleSolved', (data) => {
                logEvent('puzzleSolved', data);
            });

            puzzleState.on('puzzleReset', (data) => {
                logEvent('puzzleReset', data);
            });
        }

        // ELO selector functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Setup state management demo after a short delay to ensure widgets are initialized
            setTimeout(() => {
                setupStateDemo();
            }, 500);

            const eloButtons = document.querySelectorAll('.elo-btn');
            const eloGroups = document.querySelectorAll('.elo-group');

            eloButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const selectedElo = this.dataset.elo;

                    // Remove active class from all buttons
                    eloButtons.forEach(btn => btn.classList.remove('active'));
                    // Add active class to clicked button
                    this.classList.add('active');

                    // Hide all elo groups
                    eloGroups.forEach(group => group.classList.remove('active'));
                    // Show selected elo group
                    const targetGroup = document.querySelector(`.elo-group[data-elo="${selectedElo}"]`);
                    if (targetGroup) {
                        targetGroup.classList.add('active');

                        // Reinitialize chess widgets in the new group
                        setTimeout(() => {
                            const widgets = targetGroup.querySelectorAll('.chess-puzzle');
                            widgets.forEach(widget => {
                                // Clear existing widget if any
                                widget.innerHTML = '';
                                // Reinitialize
                                if (window.ChessWidget) {
                                  new window.ChessWidget(widget);
                                } else {
                                  console.error('ChessWidget is not available on window. Ensure demo/main.js loaded src/chess-widget.js');
                                }
                            });
                        }, 100);
                    }
                });
            });
        });
    </script>
</body>
</html>
